<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.ULhG9gpl.css" rel="stylesheet">
		<link href="../_app/immutable/assets/Toaster.Dljj2rV8.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.BJlDkOpa.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.Ckx-DEvp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.Ie7rGrFD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/runtime.BAFUM52B.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.HqDmpUJI.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/disclose-version.Bedei8AD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index-client.KQq4m8LZ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/svelte-component.DMSORSFP.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.ChhUFNes.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Toaster.svelte_svelte_type_style_lang.BmHREJqO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/store.9yGI1nh7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/attributes.D0NGgthW.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.DWgPtC_I.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/stores.B8GNZjuf.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.DJF7piDy.js"><!--[--><!--[--><!--]!--> <!--[--><script nonce="%sveltekit.nonce%">(function setInitialMode(defaultMode, themeColors2) {
  const rootEl = document.documentElement;
  const mode = localStorage.getItem("mode-watcher-mode") || defaultMode;
  const light = mode === "light" || mode === "system" && window.matchMedia("(prefers-color-scheme: light)").matches;
  rootEl.classList[light ? "remove" : "add"]("dark");
  rootEl.style.colorScheme = light ? "light" : "dark";
  if (themeColors2) {
    const themeMetaEl = document.querySelector('meta[name="theme-color"]');
    if (themeMetaEl) {
      themeMetaEl.setAttribute("content", mode === "light" ? themeColors2.light : themeColors2.dark);
    }
  }
  localStorage.setItem("mode-watcher-mode", mode);
})("system");</script><!--]--><!--]--><!--[--><meta property="og:type" content="article"> <meta property="og:title" content="Passkeys"><!--]--><title>Passkeys</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!--[--><!--[--><!--]--> <!--[--><!--[--><!--]!--><!--]--> <!--[--><header class="sticky top-0 z-50 overflow-x-hidden border-b border-border bg-background/75 backdrop-blur-md"><div class="container px-4"><div class="flex h-[70px] items-center justify-between gap-3"><div class="flex items-center gap-1.5"><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><button  type="button" tabindex="0" aria-haspopup="dialog" aria-expanded="false" data-melt-dialog-trigger="" data-dialog-trigger="" class="inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:text-accent-foreground h-10 py-2 mr-2 px-0 text-base hover:bg-transparent focus-visible:bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 md:hidden" data-button-root=""><!--[--><!--[--><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-menu h-5 w-5"><!--[--><!--[--><!--[--><line  x1="4" x2="20" y1="12" y2="12"><!--[--><!--]--></line><!--]--><!--]--><!--[--><!--[--><line  x1="4" x2="20" y1="6" y2="6"><!--[--><!--]--></line><!--]--><!--]--><!--[--><!--[--><line  x1="4" x2="20" y1="18" y2="18"><!--[--><!--]--></line><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <span class="sr-only">Toggle Menu</span><!--]--><!--]--><!--]--></button><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <!--[--><!--[--><!--[--><!--[--><div data-portal="" data-melt-dialog-portalled="" data-dialog-portal=""><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]--><!--]--> <!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]--><!--]--><!--]--></div><!--]!--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="/" class="ml-2 rounded-md font-quicksand focus-visible:outline-none text-xl font-bold focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background">The Copenhagen Book</a></div> <div class="flex items-center justify-end gap-2.5"><!--[--><!--[--><!--[--><!--[--><button  type="button" tabindex="0" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10" data-button-root=""><!--[--><!--[--><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-sun h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><!--[--><!--[--><!--[--><circle  cx="12" cy="12" r="4"><!--[--><!--]--></circle><!--]--><!--]--><!--[--><!--[--><path  d="M12 2v2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M12 20v2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m4.93 4.93 1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m17.66 17.66 1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M2 12h2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M20 12h2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m6.34 17.66-1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m19.07 4.93-1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-moon absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><!--[--><!--[--><!--[--><path  d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <span class="sr-only">Change theme</span><!--]--><!--]--><!--]--></button><!--]--><!--]!--><!--]--><!--]--></div></div></div></header><!--]--> <div class="min-h-[calc(100vh-64px)]"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[250px_minmax(0,1fr)] lg:gap-10"><!--[--><!--[--><aside class="fixed top-10 z-30 hidden h-[calc(100vh-3.5rem)] w-full shrink-0 overflow-y-auto border-r border-border md:sticky md:block"><div class="h-full py-6 pr-4 lg:py-8"><nav class="space-y-3"><div class="flex w-full flex-col pb-[50px]"><!--[--><!--[--><!--[--><!--[--><!--[--><div class="grid grid-flow-row auto-rows-max gap-0.5 pb-2 pl-4 text-sm"><!--[--><!--[--><!--[--><a href="/content/index" class="group flex w-full items-center gap-2.5 rounded-md px-2.5 py-1.5 text-sm font-semibold text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Introduction <!--[--><!--]!--></a><!--]--><!--]--><!--]--></div><!--]--><!--]--><!--]--><!--]--><!--[--><!--[--><div class="pb-4"><h4 class="mb-1 ml-[9px] rounded-md px-2.5 py-2 pl-4 text-xs font-medium uppercase text-muted-foreground">content</h4> <!--[--><!--[--><!--[--><div class="grid grid-flow-row auto-rows-max gap-0.5 pl-4 text-sm"><!--[--><!--[--><!--[--><a href="/content/server-side-tokens" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Server-side tokens <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/sessions" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Sessions <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/password-authentication" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Password authentication <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/email-verification" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Email verification <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/password-reset" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Password reset <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/random-values" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Generating random values <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/oauth" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">OAuth <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/mfa" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Multi-factor authentication (MFA) <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/passkeys" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background text-blue-600 dark:text-blue-500" target="" rel="">Passkeys <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/csrf" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Cross-site request forgery (CSRF) <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/open-redirect" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Open redirect <!--[--><!--]!--></a><!--]--><!--]--><!--]--></div><!--]--><!--]--><!--]--></div><!--]!--><!--]--><!--]--></div></nav></div></aside><!--]--><!--]--> <main class="relative pb-6 pl-4 pr-4 pt-16 md:pl-0 lg:gap-10 xl:grid-cols-[1fr_220px] xl:grid"><div class="mx-auto w-full min-w-0 md:max-w-[700px]" id="content"><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><h1 class="mt-2 scroll-m-20 text-4xl font-bold" id="passkeys"><!--[-->Passkeys<!--]--></h1><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="overview"><!--[-->Overview<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Passkeys are built on top of the <!--[--><a href="https://www.w3.org/TR/webauthn-2/" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->Web Authentication (WebAuthn) standard<!--]--></a><!--]--> and allow applications to authenticate users with in-device authentication methods, including biometrics and device pin-code. It can be more secure than traditional passwords as it doesn't require the user to remember their passwords. It can replace passwords entirely or be used in addition to passwords as a <!--[--><a href="/content/mfa" class="link text-blue-600 dark:text-blue-500"><!--[-->second factor<!--]--></a><!--]-->.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Passkeys are based on public key cryptography, where each user has a public-private key pair. The private key is stored in the user's device, while the public key is stored in your application. The device creates a signature with the private key and your application can use the public key to verify it.<!--]--></p><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="challenge"><!--[-->Challenge<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Each attestation and assertion has a challenge associated with it. A challenge is a randomly generated single-use <!--[--><a href="/content/server-side-tokens" class="link text-blue-600 dark:text-blue-500"><!--[-->token<!--]--></a><!--]--> stored in the server to prevent replay attacks. The recommended minimum entropy is 16 bytes.<!--]--></p><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="registration"><!--[-->Registration<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->In the client, get a new challenge from the server and create a new credential with the <!--[--><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->Web Authentication API<!--]--></a><!--]-->. This will prompt the user to authenticate with their device. Browsers such as Safari will only allow you to call this method if it was initiated by a user interaction (button click).<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>const publicKeyCredential: PublicKeyCredential = await navigator.credentials.create(&#123;</span></span>
<span data-line=""><span>	publicKey: &#123;</span></span>
<span data-line=""><span>		rp: &#123; name: 'My app' &#125;,</span></span>
<span data-line=""><span>		user: &#123;</span></span>
<span data-line=""><span>			id: crypto.getRandomValues(new Uint8Array(32)),</span></span>
<span data-line=""><span>			name: userId,</span></span>
<span data-line=""><span>			displayName: username</span></span>
<span data-line=""><span>		&#125;,</span></span>
<span data-line=""><span>		pubKeyCredParams: [</span></span>
<span data-line=""><span>			&#123;</span></span>
<span data-line=""><span>				type: 'public-key',</span></span>
<span data-line=""><span>				// ECDSA with SHA-256</span></span>
<span data-line=""><span>				alg: -7</span></span>
<span data-line=""><span>			&#125;</span></span>
<span data-line=""><span>		],</span></span>
<span data-line=""><span>		challenge</span></span>
<span data-line=""><span>	&#125;</span></span>
<span data-line=""><span>&#125;);</span></span>
<span data-line=""><span>const response: AuthenticatorAttestationResponse = publicKeyCredential.response;</span></span>
<span data-line=""> </span>
<span data-line=""><span>const publicKey: ArrayBuffer = response.getPublicKey();</span></span>
<span data-line=""><span>const clientDataJSON: ArrayBuffer = response.clientDataJSON;</span></span>
<span data-line=""><span>const authenticatorData: ArrayBuffer = response.getAuthenticatorData();</span></span>
<span data-line=""><span>const credentialId: string = publicKeyCredential.id;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><ul class="ml-6 list-disc"><!--[--><!--[--><li class="mt-2"><!--[--><!--[--><code>rp.name</code><!--]-->: Your application's name<!--]--></li><!--]--> <!--[--><li class="mt-2"><!--[--><!--[--><code>user.id</code><!--]-->: Random ID<!--]--></li><!--]--> <!--[--><li class="mt-2"><!--[--><!--[--><code>user.name</code><!--]-->: Unique user identifier (user ID, username, email)<!--]--></li><!--]--> <!--[--><li class="mt-2"><!--[--><!--[--><code>user.displayName</code><!--]-->: Does not need to be unique<!--]--></li><!--]--><!--]--></ul><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The algorithm ID is from the <!--[--><a href="https://www.iana.org/assignments/cose/cose.xhtml" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->IANA COSE Algorithms registry<!--]--></a><!--]-->. ECDSA with SHA-256 (ES256) is recommended as it is widely supported. You can also pass <!--[--><code>-257</code><!--]--> for RSASSA-PKCS1-v1_5 (RS256) to support a wider range of devices but devices that only support it are rare.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The public key, client data, authenticator data, credential ID, and the challenge are sent to the server for verification. A simple way to send binary data is by encoding it with base64.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The first step is to validate the challenge. Make sure to delete the challenge from storage as it is single-use. Next, check the client data and authenticator data. The origin is the domain your application is hosted on, including the protocol and port, and the relying party ID is the domain without the protocol or port.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>import (</span></span>
<span data-line=""><span>	"bytes"</span></span>
<span data-line=""><span>	"crypto/sha256"</span></span>
<span data-line=""><span>	"encoding/base64"</span></span>
<span data-line=""><span>	"encoding/json"</span></span>
<span data-line=""><span>	"errors"</span></span>
<span data-line=""><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>var challenge []byte</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Verify the challenge and delete it from storage.</span></span>
<span data-line=""> </span>
<span data-line=""><span>var publicKey, clientDataJSON, authenticatorData []byte</span></span>
<span data-line=""><span>var credentialId string</span></span>
<span data-line=""> </span>
<span data-line=""><span>var clientData ClientData</span></span>
<span data-line=""><span>json.Unmarshal(clientDataJSON, &amp;clientData)</span></span>
<span data-line=""> </span>
<span data-line=""><span>if clientData.Type != "webauthn.create" &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid type")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>if clientData.Challenge != base64.URLEncoding.WithPadding(base64.NoPadding).EncodeToString(challenge) &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid challenge")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>if clientData.Origin != "https://example.com" &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid origin")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""> </span>
<span data-line=""><span>if len(authenticatorData) &lt; 37 &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid authenticator data")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>rpIdHash := authenticatorData[0:32]</span></span>
<span data-line=""><span>expectedRpIdHash := sha256.Sum256([]byte("example.com"))</span></span>
<span data-line=""><span>if bytes.Equal(rpIdHash, expectedRpIdHash[:]) &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid relying party ID")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>// Check for the "user present" flag.</span></span>
<span data-line=""><span>if (authenticatorData[32] &amp; 1) != 1 &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid flag")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""> </span>
<span data-line=""><span>type ClientData struct &#123;</span></span>
<span data-line=""><span>	Type	  string &#96;json:"type"&#96;</span></span>
<span data-line=""><span>	Challenge string &#96;json:"challenge"&#96;</span></span>
<span data-line=""><span>	Origin	string &#96;json:"origin"&#96;</span></span>
<span data-line=""><span>&#125;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Optionally, validate the attestation statement to verify that the attestation came from a legitimate device. However, unless your application has strict security or needs to verify the authenticity of the user's device, this is likely unnecessary.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The authenticator data also includes a signature counter that is incremented every time a new signature is generated, which can be used to detect cloned authenticators. However, for passkeys specifically, this is not necessary as credentials are designed to be exported and shared.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Finally, check if the public key is valid, and create a new user with their public key and the credential ID. The public key is in the SubjectPublicKeyInfo format. If you support multiple algorithms, you can parse the public key to get the algorithm identifier.<!--]--></p><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="authentication"><!--[-->Authentication<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Generate a challenge on the server and use it to authenticate the user client side.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>const publicKeyCredential: PublicKeyCredential = await navigator.credentials.get(&#123;</span></span>
<span data-line=""><span>	publicKey: &#123;</span></span>
<span data-line=""><span>		challenge</span></span>
<span data-line=""><span>	&#125;</span></span>
<span data-line=""><span>&#125;);</span></span>
<span data-line=""> </span>
<span data-line=""><span>const response: AuthenticatorAssertionResponse = publicKeyCredential.response;</span></span>
<span data-line=""><span>const clientDataJSON: ArrayBuffer = response.clientDataJSON);</span></span>
<span data-line=""><span>const authenticatorData: ArrayBuffer = response.authenticatorData);</span></span>
<span data-line=""><span>const signature: ArrayBuffer = response.signature);</span></span>
<span data-line=""><span>const credentialId: string = publicKeyCredential.id;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The client data, authenticator data, signature, challenge, and credential ID are sent to the server. The challenge, the authenticator, and the client data are first verified. This part is nearly identical to the steps for verifying attestation.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>import (</span></span>
<span data-line=""><span>	"bytes"</span></span>
<span data-line=""><span>	"crypto/sha256"</span></span>
<span data-line=""><span>	"encoding/base64"</span></span>
<span data-line=""><span>	"encoding/json"</span></span>
<span data-line=""><span>	"errors"</span></span>
<span data-line=""><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>var challenge []byte</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Verify the challenge and delete it from storage.</span></span>
<span data-line=""> </span>
<span data-line=""><span>var clientDataJSON, authenticatorData []byte</span></span>
<span data-line=""> </span>
<span data-line=""><span>var clientData ClientData</span></span>
<span data-line=""><span>json.Unmarshal(clientDataJSON, &amp;clientData)</span></span>
<span data-line=""> </span>
<span data-line=""><span>if clientData.Type != "webauthn.get" &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid type")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>if clientData.Challenge != base64.URLEncoding.WithPadding(base64.NoPadding).EncodeToString(challenge) &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid challenge")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>if clientData.Origin != "https://example.com" &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid origin")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""> </span>
<span data-line=""><span>if len(authenticatorData) &lt; 37 &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid authenticator data")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>rpIdHash := authenticatorData[0:32]</span></span>
<span data-line=""><span>expectedRpIdHash := sha256.Sum256([]byte("example.com"))</span></span>
<span data-line=""><span>if !bytes.Equal(rpIdHash, expectedRpIdHash[:]) &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid relying party ID")</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""><span>// Check for the "user present" flag.</span></span>
<span data-line=""><span>if (authenticatorData[32] &amp; 1) != 1 &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid flag")</span></span>
<span data-line=""><span>&#125;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The next step is to verify the signature. Use credential ID to get the user's public key and verify the signature, which is ASN.1 DER encoded. The algorithm depends on the parameters passed when the credential was created.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>import (</span></span>
<span data-line=""><span>	"crypto/ecdsa"</span></span>
<span data-line=""><span>	"crypto/sha256"</span></span>
<span data-line=""><span>	"errors"</span></span>
<span data-line=""><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>var publicKey *ecdsa.PublicKey</span></span>
<span data-line=""><span>var signature []byte</span></span>
<span data-line=""> </span>
<span data-line=""><span>hashedClientDataJSON := sha256.Sum256(clientDataJSON)</span></span>
<span data-line=""><span>// Concatenate the authenticator data with the hashed client data JSON.</span></span>
<span data-line=""><span>data := append(authenticatorData, hashedClientDataJSON[:]...)</span></span>
<span data-line=""><span>hash := sha256.Sum256(data)</span></span>
<span data-line=""> </span>
<span data-line=""><span>validSignature := ecdsa.VerifyASN1(publicKey, hash[:], signature)</span></span>
<span data-line=""><span>if !validSignature &#123;</span></span>
<span data-line=""><span>	return errors.New("invalid signature")</span></span>
<span data-line=""><span>&#125;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure><!--]--><!--]--><!--]--><!--]--><!--]--></div> <!--[--><div class="hidden text-sm xl:block"><div class="sticky top-16 -mt-10 h-[calc(100vh-3.5rem)] overflow-hidden pt-6"><!--[--><div class="mt-1 overflow-y-auto rounded-lg p-4"><nav><!--[--><!--[--><ul class="m-0 list-none"><!--[--><!--]!--></ul><!--]--><!--]--></nav></div><!--]--></div></div><!--]--></main></div></div><!--]--><!--]--> <!--[--><!--]!--><!--]-->
			
			<script>
				{
					__sveltekit_rpkwke = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("../_app/immutable/entry/start.Ckx-DEvp.js"),
						import("../_app/immutable/entry/app.HqDmpUJI.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
<!--- /\_/\ --->
<!---( o.o )--->
<!--- > ^ < --->
