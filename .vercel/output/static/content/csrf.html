<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../_app/immutable/assets/0.ULhG9gpl.css" rel="stylesheet">
		<link href="../_app/immutable/assets/Toaster.Dljj2rV8.css" rel="stylesheet">
		<link href="../_app/immutable/assets/3.BJlDkOpa.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.Ckx-DEvp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.Ie7rGrFD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/runtime.BAFUM52B.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/control.CYgJF_JY.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.HqDmpUJI.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/disclose-version.Bedei8AD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index-client.KQq4m8LZ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/svelte-component.DMSORSFP.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.ChhUFNes.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Toaster.svelte_svelte_type_style_lang.BmHREJqO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/store.9yGI1nh7.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/attributes.D0NGgthW.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.DWgPtC_I.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/stores.B8GNZjuf.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/3.DJF7piDy.js"><!--[--><!--[--><!--]!--> <!--[--><script nonce="%sveltekit.nonce%">(function setInitialMode(defaultMode, themeColors2) {
  const rootEl = document.documentElement;
  const mode = localStorage.getItem("mode-watcher-mode") || defaultMode;
  const light = mode === "light" || mode === "system" && window.matchMedia("(prefers-color-scheme: light)").matches;
  rootEl.classList[light ? "remove" : "add"]("dark");
  rootEl.style.colorScheme = light ? "light" : "dark";
  if (themeColors2) {
    const themeMetaEl = document.querySelector('meta[name="theme-color"]');
    if (themeMetaEl) {
      themeMetaEl.setAttribute("content", mode === "light" ? themeColors2.light : themeColors2.dark);
    }
  }
  localStorage.setItem("mode-watcher-mode", mode);
})("system");</script><!--]--><!--]--><!--[--><meta property="og:type" content="article"> <meta property="og:title" content="Cross-site request forgery (CSRF)"><!--]--><title>Cross-site request forgery (CSRF)</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!--[--><!--[--><!--]--> <!--[--><!--[--><!--]!--><!--]--> <!--[--><header class="sticky top-0 z-50 overflow-x-hidden border-b border-border bg-background/75 backdrop-blur-md"><div class="container px-4"><div class="flex h-[70px] items-center justify-between gap-3"><div class="flex items-center gap-1.5"><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><button  type="button" tabindex="0" aria-haspopup="dialog" aria-expanded="false" data-melt-dialog-trigger="" data-dialog-trigger="" class="inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:text-accent-foreground h-10 py-2 mr-2 px-0 text-base hover:bg-transparent focus-visible:bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 md:hidden" data-button-root=""><!--[--><!--[--><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-menu h-5 w-5"><!--[--><!--[--><!--[--><line  x1="4" x2="20" y1="12" y2="12"><!--[--><!--]--></line><!--]--><!--]--><!--[--><!--[--><line  x1="4" x2="20" y1="6" y2="6"><!--[--><!--]--></line><!--]--><!--]--><!--[--><!--[--><line  x1="4" x2="20" y1="18" y2="18"><!--[--><!--]--></line><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <span class="sr-only">Toggle Menu</span><!--]--><!--]--><!--]--></button><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <!--[--><!--[--><!--[--><!--[--><div data-portal="" data-melt-dialog-portalled="" data-dialog-portal=""><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]--><!--]--> <!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]!--><!--]--><!--]--><!--]--></div><!--]!--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="/" class="ml-2 rounded-md font-quicksand focus-visible:outline-none text-xl font-bold focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background">The Copenhagen Book</a></div> <div class="flex items-center justify-end gap-2.5"><!--[--><!--[--><!--[--><!--[--><button  type="button" tabindex="0" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-10 w-10" data-button-root=""><!--[--><!--[--><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-sun h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><!--[--><!--[--><!--[--><circle  cx="12" cy="12" r="4"><!--[--><!--]--></circle><!--]--><!--]--><!--[--><!--[--><path  d="M12 2v2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M12 20v2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m4.93 4.93 1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m17.66 17.66 1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M2 12h2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="M20 12h2"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m6.34 17.66-1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--[--><!--[--><path  d="m19.07 4.93-1.41 1.41"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-moon absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><!--[--><!--[--><!--[--><path  d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--> <span class="sr-only">Change theme</span><!--]--><!--]--><!--]--></button><!--]--><!--]!--><!--]--><!--]--></div></div></div></header><!--]--> <div class="min-h-[calc(100vh-64px)]"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[250px_minmax(0,1fr)] lg:gap-10"><!--[--><!--[--><aside class="fixed top-10 z-30 hidden h-[calc(100vh-3.5rem)] w-full shrink-0 overflow-y-auto border-r border-border md:sticky md:block"><div class="h-full py-6 pr-4 lg:py-8"><nav class="space-y-3"><div class="flex w-full flex-col pb-[50px]"><!--[--><!--[--><!--[--><!--[--><!--[--><div class="grid grid-flow-row auto-rows-max gap-0.5 pb-2 pl-4 text-sm"><!--[--><!--[--><!--[--><a href="/content/index" class="group flex w-full items-center gap-2.5 rounded-md px-2.5 py-1.5 text-sm font-semibold text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Introduction <!--[--><!--]!--></a><!--]--><!--]--><!--]--></div><!--]--><!--]--><!--]--><!--]--><!--[--><!--[--><div class="pb-4"><h4 class="mb-1 ml-[9px] rounded-md px-2.5 py-2 pl-4 text-xs font-medium uppercase text-muted-foreground">content</h4> <!--[--><!--[--><!--[--><div class="grid grid-flow-row auto-rows-max gap-0.5 pl-4 text-sm"><!--[--><!--[--><!--[--><a href="/content/server-side-tokens" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Server-side tokens <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/sessions" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Sessions <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/password-authentication" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Password authentication <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/email-verification" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Email verification <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/password-reset" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Password reset <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/random-values" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Generating random values <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/oauth" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">OAuth <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/mfa" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Multi-factor authentication (MFA) <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/passkeys" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Passkeys <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/csrf" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background text-blue-600 dark:text-blue-500" target="" rel="">Cross-site request forgery (CSRF) <!--[--><!--]!--></a><!--]--><!--]--><!--[--><!--[--><a href="/content/open-redirect" class="group inline-flex w-full items-center rounded-md px-2.5 py-1.5 text-foreground transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background hover:underline" target="" rel="">Open redirect <!--[--><!--]!--></a><!--]--><!--]--><!--]--></div><!--]--><!--]--><!--]--></div><!--]!--><!--]--><!--]--></div></nav></div></aside><!--]--><!--]--> <main class="relative pb-6 pl-4 pr-4 pt-16 md:pl-0 lg:gap-10 xl:grid-cols-[1fr_220px] xl:grid"><div class="mx-auto w-full min-w-0 md:max-w-[700px]" id="content"><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><h1 class="mt-2 scroll-m-20 text-4xl font-bold" id="cross-site-request-forgery-csrf"><!--[-->Cross-site request forgery (CSRF)<!--]--></h1><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="overview"><!--[-->Overview<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->CSRF attacks allow an attacker to make authenticated requests on behalf of users when credentials are stored in cookies.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->When a client makes a cross-origin request, the browser sends a preflight request to check whether the request is allowed (CORS). However, for certain "simple" requests, including form submissions, this step is omitted. And since cookies are automatically included even for cross-origin requests, it allows a malicious actor to make requests as the authenticated user without ever directly stealing the token from any domain. The <!--[--><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->same-origin policy<!--]--></a><!--]--> prohibits cross-origin clients from reading responses by default, but the request still goes through.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->For example, if you are signed into <!--[--><code>bank.com</code><!--]-->, your session cookie will be sent alongside this form submission even if the form is hosted on a different domain.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>&lt;form action="https://bank.com/send-money" method="post"></span></span>
<span data-line=""><span>	&lt;input name="recipient" value="attacker" /></span></span>
<span data-line=""><span>	&lt;input name="value" value="$100" /></span></span>
<span data-line=""><span>	&lt;button>Send money&lt;/button></span></span>
<span data-line=""><span>&lt;/form></span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->This can just be a <!--[--><code>fetch()</code><!--]--> request so no user input is required.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>const body = new URLSearchParams();</span></span>
<span data-line=""><span>body.set('recipient', 'attacker');</span></span>
<span data-line=""><span>body.set('value', '$100');</span></span>
<span data-line=""> </span>
<span data-line=""><span>await fetch('https://bank.com/send-money', &#123;</span></span>
<span data-line=""><span>	method: 'POST',</span></span>
<span data-line=""><span>	body</span></span>
<span data-line=""><span>&#125;);</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><h3 class="mt-6 scroll-m-20 text-xl font-semibold tracking-tight" id="cross-site-vs-cross-origin"><!--[-->Cross-site vs cross-origin<!--]--></h3><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->While requests between 2 totally different domains are considered as both cross-site and cross-origin, those between 2 subdomains are not considered cross-site but are considered cross-origin requests. While the name cross-site request forgery implies cross-site requests, you should be strict by default and protect your application from cross-origin attacks as well.<!--]--></p><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="prevention"><!--[-->Prevention<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->CSRF can be prevented by only accepting POST and POST-like requests made by browsers from a trusted origin.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Protection must be implemented for all routes that deal with forms. If your application does not currently use forms, it may still be a good idea to at least <!--[--><a href="#origin-header" class="link text-blue-600 dark:text-blue-500"><!--[-->check the <!--[--><code>Origin</code><!--]--> header<!--]--></a><!--]--> to prevent future issues. It's also a generally good idea to only modify resources using POST and POST-like methods (PUT, DELETE, etc).<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->For the common token-based approach, the token should not be single-use (e.g. a new token for every form submission) as it will break with a single back button. It is also crucial that your pages have a strict cross-origin resource sharing (CORS) policy. If <!--[--><code>Access-Control-Allow-Credentials</code><!--]--> is not strict, a malicious site can send a GET request to get an HTML form with a valid CSRF token.<!--]--></p><!--]--> <!--[--><h3 class="mt-6 scroll-m-20 text-xl font-semibold tracking-tight" id="anti-csrf-tokens"><!--[-->Anti-CSRF tokens<!--]--></h3><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->This is a very simple method where each session has a unique CSRF <!--[--><a href="/content/server-side-tokens" class="link text-blue-600 dark:text-blue-500"><!--[-->token<!--]--></a><!--]--> associated with it.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>&lt;form method="post"></span></span>
<span data-line=""><span>	&lt;input name="message" /></span></span>
<span data-line=""><span>	&lt;input type="hidden" name="__csrf" value="&lt;CSRF_TOKEN>" /></span></span>
<span data-line=""><span>	&lt;button>Submit&lt;/button></span></span>
<span data-line=""><span>&lt;/form></span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><h3 class="mt-6 scroll-m-20 text-xl font-semibold tracking-tight" id="signed-double-submit-cookies"><!--[-->Signed double-submit cookies<!--]--></h3><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->If storing the token server-side is not an option, using signed double-submit cookies is another approach. This is different from the basic double submit cookie in that the token included in the form is signed with a secret.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->A new <!--[--><a href="/content/server-side-tokens" class="link text-blue-600 dark:text-blue-500"><!--[-->token<!--]--></a><!--]--> is generated and hashed with HMAC SHA-256 using a secret key.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>func generateCSRFToken() (string, []byte) &#123;</span></span>
<span data-line=""><span>	buffer := [10]byte&#123;&#125;</span></span>
<span data-line=""><span>	crypto.rand.Read(buffer)</span></span>
<span data-line=""><span>	csrfToken := base64.StdEncoding.encodeToString(buffer)</span></span>
<span data-line=""><span>	mac := hmac.New(sha256.New, secret)</span></span>
<span data-line=""><span>	mac.Write([]byte(csrfToken))</span></span>
<span data-line=""><span>	csrfTokenHMAC := mac.Sum(nil)</span></span>
<span data-line=""><span>	return csrfToken, csrfTokenHMAC</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Optionally, link the cookie to a specific session ID.</span></span>
<span data-line=""><span>func generateCSRFToken(sessionId string) (string, []byte) &#123;</span></span>
<span data-line=""><span>	// ...</span></span>
<span data-line=""><span>	mac.Write([]byte(csrfToken + "." + sessionId))</span></span>
<span data-line=""><span>	csrfTokenHMAC := mac.Sum(nil)</span></span>
<span data-line=""><span>	return csrfToken, csrfTokenHMAC</span></span>
<span data-line=""><span>&#125;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The token is stored as a cookie and the HMAC is stored in the form. The cookie should have a <!--[--><code>Secure</code><!--]-->, <!--[--><code>HttpOnly</code><!--]-->, and <!--[--><code>SameSite</code><!--]--> flag. To validate a request, the cookie can be used to verify the signature sent in the form data.<!--]--></p><!--]--> <!--[--><h4 class="mt-4 scroll-m-20 text-lg font-semibold tracking-tight" id="traditional-double-submit-cookies"><!--[-->Traditional double-submit cookies<!--]--></h4><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Regular double-submit cookies that aren't signed will still leave you vulnerable if an attacker has access to a subdomain of your application's domain. This would allow them to set their own double-submit cookies.<!--]--></p><!--]--> <!--[--><h3 class="mt-6 scroll-m-20 text-xl font-semibold tracking-tight" id="origin-header"><!--[-->Origin header<!--]--></h3><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->A very simple way to prevent CSRF attacks is to check the <!--[--><code>Origin</code><!--]--> header of the request for non-GET requests. This is a relatively new header that includes the request <!--[--><a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->origin<!--]--></a><!--]-->. If you rely on this header, it is crucial that your application does not use GET requests for modifying resources.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->While the <!--[--><code>Origin</code><!--]--> header can be spoofed by using a custom client, the important part is that it can't be done using client-side JavaScript. Users are only vulnerable to CSRF when using a browser.<!--]--></p><!--]--> <figure data-rehype-pretty-code-figure=""><!--[--><pre class="relative mb-4 mt-6 overflow-x-auto rounded-card border-2 border-muted py-8 Serendipity Midnight Serendipity Morning" tabindex="0" data-language="untype" data-theme="Serendipity Midnight Serendipity Morning">
	<!--[--><!--[--><code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>func handleRequest(w http.ResponseWriter, request *http.Request) &#123;</span></span>
<span data-line=""><span>  	if request.Method != "GET" &#123;</span></span>
<span data-line=""><span>		originHeader := request.Header.Get()</span></span>
<span data-line=""><span>		// You can also compare it against the Host or X-Forwarded-Host header.</span></span>
<span data-line=""><span>		if originHeader != "https://example.com" &#123;</span></span>
<span data-line=""><span>			// Invalid request origin</span></span>
<span data-line=""><span>			w.WriteHeader(403)</span></span>
<span data-line=""><span>			return</span></span>
<span data-line=""><span>		&#125;</span></span>
<span data-line=""><span>  	&#125;</span></span>
<span data-line=""><span>  	// ...</span></span>
<span data-line=""><span>&#125;</span></span></code><!--]--><!--]-->
	<!--[--><button class="z-20 inline-flex h-9 w-9 items-center justify-center rounded-md text-sm font-medium text-muted-foreground transition-colors hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground focus-visible:ring-offset-2 focus-visible:ring-offset-background absolute right-4 top-4" aria-label="Copy" data-copy-code="true"><!--[--><!--[--><!--[--><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon lucide lucide-copy h-5 w-5"><!--[--><!--[--><!--[--><rect  width="14" height="14" x="8" y="8" rx="2" ry="2"><!--[--><!--]--></rect><!--]--><!--]--><!--[--><!--[--><path  d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"><!--[--><!--]--></path><!--]--><!--]--><!--]--><!--[--><!--[--><!--]--><!--]--></svg><!--]--><!--]--><!--]!--></button><!--]-->
</pre><!--]--></figure> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The <!--[--><code>Origin</code><!--]--> header has been supported by all modern browsers since around 2020, though Chrome and Safari have supported it before that. If the <!--[--><code>Origin</code><!--]--> header is not included, do not allow the request.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->The <!--[--><code>Referer</code><!--]--> header is a similar header introduced before the <!--[--><code>Origin</code><!--]--> header. This can be used as a fallback if the <!--[--><code>Origin</code><!--]--> header isn't defined.<!--]--></p><!--]--> <!--[--><h2 class="mt-6 -scroll-m-36 text-[27px] font-semibold tracking-[-0.01em] first:mt-0" id="samesite-cookie-attribute"><!--[-->SameSite cookie attribute<!--]--></h2><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->Session cookies should have a <!--[--><code>SameSite</code><!--]--> flag. This flag determines when the browser includes the cookie in requests. <!--[--><code>SameSite=Lax</code><!--]--> cookies will only be sent on cross-site requests if the request uses a <!--[--><a href="https://developer.mozilla.org/en-US/docs/Glossary/Safe/HTTP" target="_blank" rel="noopener noreferrer" class="link text-blue-600 dark:text-blue-500"><!--[-->safe HTTP method<!--]--></a><!--]--> (such as GET), while <!--[--><code>SameSite=Strict</code><!--]--> cookies will not be sent on any cross site requests. We recommend using <!--[--><code>Lax</code><!--]--> as the default as <!--[--><code>Strict</code><!--]--> cookies will not be sent when a user accesses your website via an external link.<!--]--></p><!--]--> <!--[--><p class="leading-7 [&amp;:not(:first-child)]:mt-2"><!--[-->If you set the value to <!--[--><code>Lax</code><!--]-->, it is crucial that your application does not use GET requests for modifying resources. Browser support for the <!--[--><code>SameSite</code><!--]--> flag shows it is currently available to 96% of web users. It’s important to note that the flag only protects against <em>cross-site</em> request forgery (not <em>cross-origin</em> request forgery), and generally shouldn’t be your only layer of defense.<!--]--></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></div> <!--[--><div class="hidden text-sm xl:block"><div class="sticky top-16 -mt-10 h-[calc(100vh-3.5rem)] overflow-hidden pt-6"><!--[--><div class="mt-1 overflow-y-auto rounded-lg p-4"><nav><!--[--><!--[--><ul class="m-0 list-none"><!--[--><!--]!--></ul><!--]--><!--]--></nav></div><!--]--></div></div><!--]--></main></div></div><!--]--><!--]--> <!--[--><!--]!--><!--]-->
			
			<script>
				{
					__sveltekit_rpkwke = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("../_app/immutable/entry/start.Ckx-DEvp.js"),
						import("../_app/immutable/entry/app.HqDmpUJI.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
<!--- /\_/\ --->
<!---( o.o )--->
<!--- > ^ < --->
