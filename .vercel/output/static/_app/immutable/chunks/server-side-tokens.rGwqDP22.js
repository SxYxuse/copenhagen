import{a as n,t as r,c as S,d as g,f as l,b as a}from"./disclose-version.Bedei8AD.js";import{h as U}from"./index.DWgPtC_I.js";import{B as H,H as B,P as i}from"./blueprint.CLPDHYwR.js";import{H as k}from"./h2.BLVNhL6Q.js";import{P as q}from"./pre.DAToQk2m.js";import{A as b}from"./a.CxCmjLdc.js";import{p as O,t as Q,a as K}from"./runtime.BAFUM52B.js";import{s as Y,c as j}from"./Toaster.svelte_svelte_type_style_lang.BmHREJqO.js";import{s as z}from"./attributes.D0NGgthW.js";import{p as J,r as V}from"./index-client.KQq4m8LZ.js";var W=r("<blockquote><!></blockquote>");function Z(h,d){O(d,!0);let v=J(d,"class",11,()=>{}),$=V(d,["class","children"]);var m=W();let p;var c=S(m);Y(()=>d.children,c),Q(()=>p=z(m,p,{class:j("mt-6 border-l-2 pl-6 italic",v()),...$},!0,"")),n(h,m),K()}var ee=r("Server-side tokens",1),ae=r("Overview",1),te=r('A "server-side token" is any long, random string that is stored on the server. It may be persisted in a database or in-memory data store (e.g. Redis) and is used for authentication and verification. A token can be validated by checking if it exists in storage. Examples include session IDs, email verification tokens, and access tokens.',1),ne=r("For single-use tokens, any retrieval should also guarantee deletion. In SQL for example, an atomic operation such as a transaction should be used when fetching a token.",1),re=r("Generating tokens",1),se=r("Generating random values",1),oe=r("Tokens should have at least 112 bits of entropy (120-256 is a good range). For example, you could generate 15 random bytes and encode it with base32 to get a 24-character token. If you generate tokens by choosing random characters one by one, you should ensure a similar level of entropy. See the <!> page for more information.",1),ie=r("Tokens must be generated using a cryptographically secure random generator. Fast, pseudo-random generators like those generally provided by standard math packages should be avoided for this.",1),de=r("Tokens should be case-sensitive, but you may want to constrain your token generation to lowercase letters if your storage is case-insensitive (e.g. MySQL).",1),le=r("For a 120 bit token, it would take someone 2 quintillion years before they guess a valid token if they generate 10,000 tokens per second and there are 1,000,000 valid tokens in the system.",1),pe=r("UUID v4 may fit these requirements (122 bits of entropy), but keep in mind that UUID v4 is space inefficient and the spec does not guarantee the use of a cryptographically secure random generator.",1),ue=r("Storing tokens",1),_e=r("Tokens that require an extra level of security, such as password reset tokens, should be hashed with SHA-256. SHA-256 can be used instead of a slower algorithm here as the token is sufficiently long and random. Tokens can be validated by hashing the incoming token before querying.",1),fe=r("Paleohacks",1),me=r("Spoutible",1),ce=r("Real-life examples of accidental leaks include <!> and <!>.",1),ge=r('<!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <!>',1);const he={title:"Server-side tokens"};function we(h){var d=g(),v=l(d);H(v,{metadata:he,children:($,m)=>{var p=ge(),c=l(p);B(c,{id:"server-side-tokens",children:(t,s)=>{var e=ee();n(t,e)},$$slots:{default:!0}});var M=a(a(c,!0));k(M,{id:"overview",children:(t,s)=>{var e=ae();n(t,e)},$$slots:{default:!0}});var P=a(a(M,!0));i(P,{children:(t,s)=>{var e=te();n(t,e)},$$slots:{default:!0}});var D=a(a(P,!0)),A=S(D);q(A,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,s)=>{var e=g(),o=l(e);U(o,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>CREATE TABLE token (</span></span>
<span data-line=""><span>	token STRING NOT NULL UNIQUE,</span></span>
<span data-line=""><span>	expires_at INTEGER NOT NULL,</span></span>
<span data-line=""><span>	user_id INTEGER NOT NULL,</span></span>
<span data-line=""> </span>
<span data-line=""><span>	FOREIGN KEY (user_id) REFERENCES user(id)</span></span>
<span data-line=""><span>)</span></span></code>`),n(t,e)},$$slots:{default:!0}});var C=a(a(D,!0));i(C,{children:(t,s)=>{var e=ne();n(t,e)},$$slots:{default:!0}});var w=a(a(C,!0));k(w,{id:"generating-tokens",children:(t,s)=>{var e=re();n(t,e)},$$slots:{default:!0}});var E=a(a(w,!0));i(E,{children:(t,s)=>{var e=oe(),o=a(l(e,!0));b(o,{href:"/content/random-values",children:(u,_)=>{var f=se();n(u,f)},$$slots:{default:!0}}),n(t,e)},$$slots:{default:!0}});var X=a(a(E,!0));i(X,{children:(t,s)=>{var e=ie();n(t,e)},$$slots:{default:!0}});var T=a(a(X,!0));i(T,{children:(t,s)=>{var e=de();n(t,e)},$$slots:{default:!0}});var N=a(a(T,!0));Z(N,{children:(t,s)=>{var e=g(),o=l(e);i(o,{children:(u,_)=>{var f=le();n(u,f)},$$slots:{default:!0}}),n(t,e)},$$slots:{default:!0}});var I=a(a(N,!0)),F=S(I);q(F,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,s)=>{var e=g(),o=l(e);U(o,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>import (</span></span>
<span data-line=""><span>	"crypto/rand"</span></span>
<span data-line=""><span>	"encoding/base32"</span></span>
<span data-line=""><span>)</span></span>
<span data-line=""> </span>
<span data-line=""><span>bytes := make([]byte, 15)</span></span>
<span data-line=""><span>rand.Read(bytes)</span></span>
<span data-line=""><span>sessionId := base32.StdEncoding.EncodeToString(bytes)</span></span></code>`),n(t,e)},$$slots:{default:!0}});var x=a(a(I,!0));i(x,{children:(t,s)=>{var e=pe();n(t,e)},$$slots:{default:!0}});var R=a(a(x,!0));k(R,{id:"storing-tokens",children:(t,s)=>{var e=ue();n(t,e)},$$slots:{default:!0}});var L=a(a(R,!0));i(L,{children:(t,s)=>{var e=_e();n(t,e)},$$slots:{default:!0}});var G=a(a(L,!0));i(G,{children:(t,s)=>{var e=ce(),o=a(l(e,!0));b(o,{href:"https://www.vpnmentor.com/blog/report-paleohacks-breach/",children:(_,f)=>{var y=fe();n(_,y)},$$slots:{default:!0}});var u=a(a(o,!0));b(u,{href:"https://www.troyhunt.com/how-spoutibles-leaky-api-spurted-out-a-deluge-of-personal-data/",children:(_,f)=>{var y=me();n(_,y)},$$slots:{default:!0}}),n(t,e)},$$slots:{default:!0}}),n($,p)},$$slots:{default:!0}}),n(h,d)}export{we as default,he as metadata};
