import{a as r,t as s,c as g,d as h,f as l,b as e}from"./disclose-version.Bedei8AD.js";import{h as i}from"./index.DWgPtC_I.js";import{B as _e,H as fe,P as p}from"./blueprint.CLPDHYwR.js";import{H as P}from"./h2.BLVNhL6Q.js";import{A as m}from"./a.CxCmjLdc.js";import{P as $}from"./pre.DAToQk2m.js";import{H as b}from"./h3.BZHhAxYy.js";import{p as he,t as me,a as ge}from"./runtime.BAFUM52B.js";import{s as ve,c as $e}from"./Toaster.svelte_svelte_type_style_lang.BmHREJqO.js";import{s as ye}from"./attributes.D0NGgthW.js";import{p as Se,r as be}from"./index-client.KQq4m8LZ.js";var Me=s("<h4><!></h4>");function ke(M,_){he(_,!0);let k=Se(_,"class",11,()=>{}),C=be(_,["class","children"]);var y=Me();let v;var S=g(y);ve(()=>_.children,S),me(()=>v=ye(y,v,{class:$e("mt-4 scroll-m-20 text-lg font-semibold tracking-tight",k()),...C},!0,"")),r(M,y),ge()}var Ce=s("Cross-site request forgery (CSRF)",1),Pe=s("Overview",1),we=s("CSRF attacks allow an attacker to make authenticated requests on behalf of users when credentials are stored in cookies.",1),Te=s("same-origin policy",1),qe=s('When a client makes a cross-origin request, the browser sends a preflight request to check whether the request is allowed (CORS). However, for certain "simple" requests, including form submissions, this step is omitted. And since cookies are automatically included even for cross-origin requests, it allows a malicious actor to make requests as the authenticated user without ever directly stealing the token from any domain. The <!> prohibits cross-origin clients from reading responses by default, but the request still goes through.',1),De=s("For example, if you are signed into <!>, your session cookie will be sent alongside this form submission even if the form is hosted on a different domain.",1),Xe=s("This can just be a <!> request so no user input is required.",1),He=s("Cross-site vs cross-origin",1),Re=s("While requests between 2 totally different domains are considered as both cross-site and cross-origin, those between 2 subdomains are not considered cross-site but are considered cross-origin requests. While the name cross-site request forgery implies cross-site requests, you should be strict by default and protect your application from cross-origin attacks as well.",1),Oe=s("Prevention",1),Fe=s("CSRF can be prevented by only accepting POST and POST-like requests made by browsers from a trusted origin.",1),Ae=s("check the <!> header",1),xe=s("Protection must be implemented for all routes that deal with forms. If your application does not currently use forms, it may still be a good idea to at least <!> to prevent future issues. It's also a generally good idea to only modify resources using POST and POST-like methods (PUT, DELETE, etc).",1),Ie=s("For the common token-based approach, the token should not be single-use (e.g. a new token for every form submission) as it will break with a single back button. It is also crucial that your pages have a strict cross-origin resource sharing (CORS) policy. If <!> is not strict, a malicious site can send a GET request to get an HTML form with a valid CSRF token.",1),Ee=s("Anti-CSRF tokens",1),We=s("token",1),Ge=s("This is a very simple method where each session has a unique CSRF <!> associated with it.",1),Le=s("Signed double-submit cookies",1),Ue=s("If storing the token server-side is not an option, using signed double-submit cookies is another approach. This is different from the basic double submit cookie in that the token included in the form is signed with a secret.",1),Be=s("token",1),Ne=s("A new <!> is generated and hashed with HMAC SHA-256 using a secret key.",1),ze=s("The token is stored as a cookie and the HMAC is stored in the form. The cookie should have a <!>, <!>, and <!> flag. To validate a request, the cookie can be used to verify the signature sent in the form data.",1),je=s("Traditional double-submit cookies",1),Je=s("Regular double-submit cookies that aren't signed will still leave you vulnerable if an attacker has access to a subdomain of your application's domain. This would allow them to set their own double-submit cookies.",1),Ke=s("Origin header",1),Ye=s("origin",1),Qe=s("A very simple way to prevent CSRF attacks is to check the <!> header of the request for non-GET requests. This is a relatively new header that includes the request <!>. If you rely on this header, it is crucial that your application does not use GET requests for modifying resources.",1),Ve=s("While the <!> header can be spoofed by using a custom client, the important part is that it can't be done using client-side JavaScript. Users are only vulnerable to CSRF when using a browser.",1),Ze=s("The <!> header has been supported by all modern browsers since around 2020, though Chrome and Safari have supported it before that. If the <!> header is not included, do not allow the request.",1),ea=s("The <!> header is a similar header introduced before the <!> header. This can be used as a fallback if the <!> header isn't defined.",1),aa=s("SameSite cookie attribute",1),ta=s("safe HTTP method",1),na=s("Session cookies should have a <!> flag. This flag determines when the browser includes the cookie in requests. <!> cookies will only be sent on cross-site requests if the request uses a <!> (such as GET), while <!> cookies will not be sent on any cross site requests. We recommend using <!> as the default as <!> cookies will not be sent when a user accesses your website via an external link.",1),ra=s("If you set the value to <!>, it is crucial that your application does not use GET requests for modifying resources. Browser support for the <!> flag shows it is currently available to 96% of web users. It’s important to note that the flag only protects against <em>cross-site</em> request forgery (not <em>cross-origin</em> request forgery), and generally shouldn’t be your only layer of defense.",1),sa=s('<!> <!> <!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <!> <!> <!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <!> <!> <!> <figure data-rehype-pretty-code-figure=""><!></figure> <!> <!> <!> <!> <!>',1);const oa={title:"Cross-site request forgery (CSRF)"};function $a(M){var _=h(),k=l(_);_e(k,{metadata:oa,children:(C,y)=>{var v=sa(),S=l(v);fe(S,{id:"cross-site-request-forgery-csrf",children:(t,o)=>{var a=Ce();r(t,a)},$$slots:{default:!0}});var w=e(e(S,!0));P(w,{id:"overview",children:(t,o)=>{var a=Pe();r(t,a)},$$slots:{default:!0}});var T=e(e(w,!0));p(T,{children:(t,o)=>{var a=we();r(t,a)},$$slots:{default:!0}});var q=e(e(T,!0));p(q,{children:(t,o)=>{var a=qe(),n=e(l(a,!0));m(n,{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy",children:(d,u)=>{var c=Te();r(d,c)},$$slots:{default:!0}}),r(t,a)},$$slots:{default:!0}});var D=e(e(q,!0));p(D,{children:(t,o)=>{var a=De(),n=e(l(a,!0));i(n,()=>"<code>bank.com</code>"),r(t,a)},$$slots:{default:!0}});var X=e(e(D,!0)),re=g(X);$(re,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,o)=>{var a=h(),n=l(a);i(n,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>&lt;form action="https://bank.com/send-money" method="post"></span></span>
<span data-line=""><span>	&lt;input name="recipient" value="attacker" /></span></span>
<span data-line=""><span>	&lt;input name="value" value="$100" /></span></span>
<span data-line=""><span>	&lt;button>Send money&lt;/button></span></span>
<span data-line=""><span>&lt;/form></span></span></code>`),r(t,a)},$$slots:{default:!0}});var H=e(e(X,!0));p(H,{children:(t,o)=>{var a=Xe(),n=e(l(a,!0));i(n,()=>"<code>fetch()</code>"),r(t,a)},$$slots:{default:!0}});var R=e(e(H,!0)),se=g(R);$(se,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,o)=>{var a=h(),n=l(a);i(n,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>const body = new URLSearchParams();</span></span>
<span data-line=""><span>body.set('recipient', 'attacker');</span></span>
<span data-line=""><span>body.set('value', '$100');</span></span>
<span data-line=""> </span>
<span data-line=""><span>await fetch('https://bank.com/send-money', &#123;</span></span>
<span data-line=""><span>	method: 'POST',</span></span>
<span data-line=""><span>	body</span></span>
<span data-line=""><span>&#125;);</span></span></code>`),r(t,a)},$$slots:{default:!0}});var O=e(e(R,!0));b(O,{id:"cross-site-vs-cross-origin",children:(t,o)=>{var a=He();r(t,a)},$$slots:{default:!0}});var F=e(e(O,!0));p(F,{children:(t,o)=>{var a=Re();r(t,a)},$$slots:{default:!0}});var A=e(e(F,!0));P(A,{id:"prevention",children:(t,o)=>{var a=Oe();r(t,a)},$$slots:{default:!0}});var x=e(e(A,!0));p(x,{children:(t,o)=>{var a=Fe();r(t,a)},$$slots:{default:!0}});var I=e(e(x,!0));p(I,{children:(t,o)=>{var a=xe(),n=e(l(a,!0));m(n,{href:"#origin-header",children:(d,u)=>{var c=Ae(),f=e(l(c,!0));i(f,()=>"<code>Origin</code>"),r(d,c)},$$slots:{default:!0}}),r(t,a)},$$slots:{default:!0}});var E=e(e(I,!0));p(E,{children:(t,o)=>{var a=Ie(),n=e(l(a,!0));i(n,()=>"<code>Access-Control-Allow-Credentials</code>"),r(t,a)},$$slots:{default:!0}});var W=e(e(E,!0));b(W,{id:"anti-csrf-tokens",children:(t,o)=>{var a=Ee();r(t,a)},$$slots:{default:!0}});var G=e(e(W,!0));p(G,{children:(t,o)=>{var a=Ge(),n=e(l(a,!0));m(n,{href:"/content/server-side-tokens",children:(d,u)=>{var c=We();r(d,c)},$$slots:{default:!0}}),r(t,a)},$$slots:{default:!0}});var L=e(e(G,!0)),oe=g(L);$(oe,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,o)=>{var a=h(),n=l(a);i(n,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>&lt;form method="post"></span></span>
<span data-line=""><span>	&lt;input name="message" /></span></span>
<span data-line=""><span>	&lt;input type="hidden" name="__csrf" value="&lt;CSRF_TOKEN>" /></span></span>
<span data-line=""><span>	&lt;button>Submit&lt;/button></span></span>
<span data-line=""><span>&lt;/form></span></span></code>`),r(t,a)},$$slots:{default:!0}});var U=e(e(L,!0));b(U,{id:"signed-double-submit-cookies",children:(t,o)=>{var a=Le();r(t,a)},$$slots:{default:!0}});var B=e(e(U,!0));p(B,{children:(t,o)=>{var a=Ue();r(t,a)},$$slots:{default:!0}});var N=e(e(B,!0));p(N,{children:(t,o)=>{var a=Ne(),n=e(l(a,!0));m(n,{href:"/content/server-side-tokens",children:(d,u)=>{var c=Be();r(d,c)},$$slots:{default:!0}}),r(t,a)},$$slots:{default:!0}});var z=e(e(N,!0)),ie=g(z);$(ie,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,o)=>{var a=h(),n=l(a);i(n,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>func generateCSRFToken() (string, []byte) &#123;</span></span>
<span data-line=""><span>	buffer := [10]byte&#123;&#125;</span></span>
<span data-line=""><span>	crypto.rand.Read(buffer)</span></span>
<span data-line=""><span>	csrfToken := base64.StdEncoding.encodeToString(buffer)</span></span>
<span data-line=""><span>	mac := hmac.New(sha256.New, secret)</span></span>
<span data-line=""><span>	mac.Write([]byte(csrfToken))</span></span>
<span data-line=""><span>	csrfTokenHMAC := mac.Sum(nil)</span></span>
<span data-line=""><span>	return csrfToken, csrfTokenHMAC</span></span>
<span data-line=""><span>&#125;</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Optionally, link the cookie to a specific session ID.</span></span>
<span data-line=""><span>func generateCSRFToken(sessionId string) (string, []byte) &#123;</span></span>
<span data-line=""><span>	// ...</span></span>
<span data-line=""><span>	mac.Write([]byte(csrfToken + "." + sessionId))</span></span>
<span data-line=""><span>	csrfTokenHMAC := mac.Sum(nil)</span></span>
<span data-line=""><span>	return csrfToken, csrfTokenHMAC</span></span>
<span data-line=""><span>&#125;</span></span></code>`),r(t,a)},$$slots:{default:!0}});var j=e(e(z,!0));p(j,{children:(t,o)=>{var a=ze(),n=e(l(a,!0));i(n,()=>"<code>Secure</code>");var d=e(e(n,!0));i(d,()=>"<code>HttpOnly</code>");var u=e(e(d,!0));i(u,()=>"<code>SameSite</code>"),r(t,a)},$$slots:{default:!0}});var J=e(e(j,!0));ke(J,{id:"traditional-double-submit-cookies",children:(t,o)=>{var a=je();r(t,a)},$$slots:{default:!0}});var K=e(e(J,!0));p(K,{children:(t,o)=>{var a=Je();r(t,a)},$$slots:{default:!0}});var Y=e(e(K,!0));b(Y,{id:"origin-header",children:(t,o)=>{var a=Ke();r(t,a)},$$slots:{default:!0}});var Q=e(e(Y,!0));p(Q,{children:(t,o)=>{var a=Qe(),n=e(l(a,!0));i(n,()=>"<code>Origin</code>");var d=e(e(n,!0));m(d,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Origin",children:(u,c)=>{var f=Ye();r(u,f)},$$slots:{default:!0}}),r(t,a)},$$slots:{default:!0}});var V=e(e(Q,!0));p(V,{children:(t,o)=>{var a=Ve(),n=e(l(a,!0));i(n,()=>"<code>Origin</code>"),r(t,a)},$$slots:{default:!0}});var Z=e(e(V,!0)),de=g(Z);$(de,{class:"Serendipity Midnight Serendipity Morning",tabindex:"0","data-language":"untype","data-theme":"Serendipity Midnight Serendipity Morning",children:(t,o)=>{var a=h(),n=l(a);i(n,()=>`<code data-language="untype" data-theme="Serendipity Midnight Serendipity Morning" style="display: grid;"><span data-line=""><span>func handleRequest(w http.ResponseWriter, request *http.Request) &#123;</span></span>
<span data-line=""><span>  	if request.Method != "GET" &#123;</span></span>
<span data-line=""><span>		originHeader := request.Header.Get()</span></span>
<span data-line=""><span>		// You can also compare it against the Host or X-Forwarded-Host header.</span></span>
<span data-line=""><span>		if originHeader != "https://example.com" &#123;</span></span>
<span data-line=""><span>			// Invalid request origin</span></span>
<span data-line=""><span>			w.WriteHeader(403)</span></span>
<span data-line=""><span>			return</span></span>
<span data-line=""><span>		&#125;</span></span>
<span data-line=""><span>  	&#125;</span></span>
<span data-line=""><span>  	// ...</span></span>
<span data-line=""><span>&#125;</span></span></code>`),r(t,a)},$$slots:{default:!0}});var ee=e(e(Z,!0));p(ee,{children:(t,o)=>{var a=Ze(),n=e(l(a,!0));i(n,()=>"<code>Origin</code>");var d=e(e(n,!0));i(d,()=>"<code>Origin</code>"),r(t,a)},$$slots:{default:!0}});var ae=e(e(ee,!0));p(ae,{children:(t,o)=>{var a=ea(),n=e(l(a,!0));i(n,()=>"<code>Referer</code>");var d=e(e(n,!0));i(d,()=>"<code>Origin</code>");var u=e(e(d,!0));i(u,()=>"<code>Origin</code>"),r(t,a)},$$slots:{default:!0}});var te=e(e(ae,!0));P(te,{id:"samesite-cookie-attribute",children:(t,o)=>{var a=aa();r(t,a)},$$slots:{default:!0}});var ne=e(e(te,!0));p(ne,{children:(t,o)=>{var a=na(),n=e(l(a,!0));i(n,()=>"<code>SameSite</code>");var d=e(e(n,!0));i(d,()=>"<code>SameSite=Lax</code>");var u=e(e(d,!0));m(u,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Safe/HTTP",children:(ue,ia)=>{var ce=ta();r(ue,ce)},$$slots:{default:!0}});var c=e(e(u,!0));i(c,()=>"<code>SameSite=Strict</code>");var f=e(e(c,!0));i(f,()=>"<code>Lax</code>");var pe=e(e(f,!0));i(pe,()=>"<code>Strict</code>"),r(t,a)},$$slots:{default:!0}});var le=e(e(ne,!0));p(le,{children:(t,o)=>{var a=ra(),n=e(l(a,!0));i(n,()=>"<code>Lax</code>");var d=e(e(n,!0));i(d,()=>"<code>SameSite</code>"),r(t,a)},$$slots:{default:!0}}),r(C,v)},$$slots:{default:!0}}),r(M,_)}export{$a as default,oa as metadata};
